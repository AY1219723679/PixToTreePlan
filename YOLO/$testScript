# PowerShell script to set up the environment and run the YOLO to 3D demo
Write-Host "Setting up environment for YOLO to 3D demo..." -ForegroundColor Green

# Get the paths
$projectRoot = "c:\Users\Ay121\OneDrive - Harvard University\文档\GitHub\PixToTreePlan"
$mainPath = Join-Path $projectRoot "main"
$corePath = Join-Path $projectRoot "core"
$coreMainPath = Join-Path $corePath "main"
$yoloDir = Join-Path $projectRoot "YOLO"

# Create the symbolic link if it doesn't exist
if (-not (Test-Path -Path $coreMainPath)) {
    Write-Host "Creating symbolic link between core/main and main..." -ForegroundColor Yellow
    
    # Create the core directory if it doesn't exist
    if (-not (Test-Path -Path $corePath)) {
        New-Item -ItemType Directory -Path $corePath -Force | Out-Null
    }
    
    # Create the symbolic link
    New-Item -ItemType Junction -Path $coreMainPath -Target $mainPath -Force | Out-Null
    Write-Host "Symbolic link created successfully." -ForegroundColor Green
} else {
    Write-Host "Symbolic link already exists." -ForegroundColor Green
}

# Create a simple Python helper script for testing imports
$testScript = Join-Path $env:TEMP "test_imports.py"
@"
import os
import sys

# Add project root to path
project_root = ''.replace('\\', '\\\\')
sys.path.append(project_root)

print('Testing imports...')
try:
    from main.img_to_pointcloud.coord_utils import pixel_coords_to_3d, load_depth_map
    print('Successfully imported from main.img_to_pointcloud')
except ImportError:
    try:
        from core.main.img_to_pointcloud.coord_utils import pixel_coords_to_3d, load_depth_map
        print('Successfully imported from core.main.img_to_pointcloud')
    except ImportError:
        print('ERROR: Cannot import coordinate utilities.')
        sys.exit(1)

print('Imports successful!')
